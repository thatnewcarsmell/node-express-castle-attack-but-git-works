Script started on 2018-11-17 06:17:09-0700
[1m[7m%[27m[1m[0m                                                                                ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;32mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnnpm nodemon app.js[?1l>[?2004l
]2;npm nodemon app.js]1;npm
Usage: npm <command>

where <command> is one of:
    access, adduser, audit, bin, bugs, c, cache, ci, cit,
    completion, config, create, ddp, dedupe, deprecate,
    dist-tag, docs, doctor, edit, explore, get, help,
    help-search, hook, i, init, install, install-test, it, link,
    list, ln, login, logout, ls, outdated, owner, pack, ping,
    prefix, profile, prune, publish, rb, rebuild, repo, restart,
    root, run, run-script, s, se, search, set, shrinkwrap, star,
    stars, start, stop, t, team, test, token, tst, un,
    uninstall, unpublish, unstar, up, update, v, version, view,
    whoami

npm <command> -h  quick help on <command>
npm -l            display full usage info
npm help <term>   search for help on <term>
npm help npm      involved overview

Specify configs in the ini-formatted file:
    /home/joshua/.npmrc
or on the command line via: npm <command> --key value
Config info can be viewed via: npm help config

npm@6.4.1 /home/joshua/.nvm/versions/node/v11.1.0/lib/node_modules/npm

[1m[7m%[27m[1m[0m                                                                                ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnnon  rrun nodemon app.s js[?1l>[?2004l
]2;run nodemon app.js]1;runzsh: command not found: run
[1m[7m%[27m[1m[0m                                                                                ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hsstart nodemon app.js[?1l>[?2004l
]2;start nodemon app.js]1;startzsh: command not found: start
[1m[7m%[27m[1m[0m                                                                                ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnnpm start[?1l>[?2004l
]2;npm start]1;npm
> express-basics-castle-attack@1.0.0 start /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> node app.js

^C
[1m[7m%[27m[1m[0m                                                                                ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hNNPM DEV[?1l>[?2004l
]2;NPM DEV]1;NPMzsh: command not found: NPM
[1m[7m%[27m[1m[0m                                                                                ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnnpm dev[?1l>[?2004l
]2;npm dev]1;npm
Usage: npm <command>

where <command> is one of:
    access, adduser, audit, bin, bugs, c, cache, ci, cit,
    completion, config, create, ddp, dedupe, deprecate,
    dist-tag, docs, doctor, edit, explore, get, help,
    help-search, hook, i, init, install, install-test, it, link,
    list, ln, login, logout, ls, outdated, owner, pack, ping,
    prefix, profile, prune, publish, rb, rebuild, repo, restart,
    root, run, run-script, s, se, search, set, shrinkwrap, star,
    stars, start, stop, t, team, test, token, tst, un,
    uninstall, unpublish, unstar, up, update, v, version, view,
    whoami

npm <command> -h  quick help on <command>
npm -l            display full usage info
npm help <term>   search for help on <term>
npm help npm      involved overview

Specify configs in the ini-formatted file:
    /home/joshua/.npmrc
or on the command line via: npm <command> --key value
Config info can be viewed via: npm help config

npm@6.4.1 /home/joshua/.nvm/versions/node/v11.1.0/lib/node_modules/npm

[1m[7m%[27m[1m[0m                                                                                ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnnpm run dev[?1l>[?2004l
]2;npm run dev]1;npm
> express-basics-castle-attack@1.0.0 dev /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> nodemon app.js

[33m[nodemon] 1.17.3[39m
[33m[nodemon] to restart at any time, enter `rs`[39m
[33m[nodemon] watching: *.*[39m
[32m[nodemon] starting `node app.js`[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
^C
[1m[7m%[27m[1m[0m                                                                                ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (20ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:14:12)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:31:12)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:54:12)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:72:12)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:13:12)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:29:12)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:45:27)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as get] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:65:12)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:78:12)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:93:12)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:111:12)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:130:12)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:145:12)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:166:12)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:187:12)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:208:12)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as get] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:228:12)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:239:12)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004h[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m nnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (21ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:14:12)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:31:12)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:54:12)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:72:12)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:13:12)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:29:12)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:45:27)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as get] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:65:12)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:78:12)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:93:12)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:111:12)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:130:12)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:145:12)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:166:12)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:187:12)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:208:12)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as get] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:228:12)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:239:12)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (22ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:14:12)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:31:12)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:54:12)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:72:12)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:13:12)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:29:12)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:45:27)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as get] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:65:12)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:78:12)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:93:12)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:111:12)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:130:12)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:145:12)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:166:12)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:187:12)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:208:12)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as get] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:228:12)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:239:12)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (21ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:14:12)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:31:12)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:54:12)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:72:12)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:13:12)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:29:12)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:45:27)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as get] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:65:12)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:78:12)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:93:12)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:111:12)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:130:12)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:145:12)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:166:12)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:187:12)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:208:12)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as get] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:228:12)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:239:12)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnnpm run dev[?1l>[?2004l
]2;npm run dev]1;npm
> express-basics-castle-attack@1.0.0 dev /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> nodemon app.js

[33m[nodemon] 1.17.3[39m
[33m[nodemon] to restart at any time, enter `rs`[39m
[33m[nodemon] watching: *.*[39m
[32m[nodemon] starting `node app.js`[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
^T^H^H      ^C
[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (21ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:14:12)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:31:12)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:54:12)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:72:12)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:13:12)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:29:12)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:45:27)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as get] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:65:12)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:78:12)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:93:12)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:111:12)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:130:12)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:145:12)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:166:12)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:187:12)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:208:12)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as get] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:228:12)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:239:12)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (22ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:14:12)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:31:12)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:54:12)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:72:12)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:13:12)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:29:12)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:45:27)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as get] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:65:12)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:78:12)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:93:12)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:111:12)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:130:12)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:145:12)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:166:12)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:187:12)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:208:12)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as get] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:228:12)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:239:12)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (21ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:14:12)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:31:12)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:54:12)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:72:12)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:13:12)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:29:12)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:45:27)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as get] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:65:12)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:78:12)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:93:12)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:111:12)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:130:12)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:145:12)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:166:12)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:187:12)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:208:12)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as get] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:228:12)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:239:12)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (22ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:14:12)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:31:12)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:54:12)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:72:12)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:13:12)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:29:12)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:45:27)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as get] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:65:12)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:78:12)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:93:12)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:111:12)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:130:12)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:145:12)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:166:12)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:187:12)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:208:12)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as get] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:228:12)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:239:12)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (21ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:14:12)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:31:12)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:54:12)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/01.kingdoms.routes.js:72:12)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:13:12)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:29:12)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:45:27)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as get] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:65:12)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:78:12)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:93:12)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:111:12)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:130:12)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:145:12)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:166:12)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:187:12)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:208:12)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as get] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:228:12)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     TypeError: app.address is not a function[0m[90m
      at serverAddress (node_modules/chai-http/lib/request.js:252:18)
      at new Test (node_modules/chai-http/lib/request.js:244:53)
      at Object.obj.(anonymous function) [as post] (node_modules/chai-http/lib/request.js:216:14)
      at Context.<anonymous> (test/02.castles.routes.js:239:12)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (80ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:

      [31mUncaught AssertionError: expected 500 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-500[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:17:35)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:58:38)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:16:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:33:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:46:57)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:81:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:114:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:133:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:148:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:169:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:190:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:211:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:242:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (77ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:

      [31mUncaught AssertionError: expected 500 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-500[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:17:35)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:58:38)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:16:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:33:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:46:57)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:81:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:114:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:133:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:148:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:169:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:190:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:211:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:242:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (79ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:

      [31mUncaught AssertionError: expected 500 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-500[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:17:35)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:58:38)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:16:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:33:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:46:57)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:81:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:114:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:133:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:148:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:169:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:190:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:211:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:242:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (78ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:

      [31mUncaught AssertionError: expected 500 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-500[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:17:35)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:58:38)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:16:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:33:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:46:57)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:81:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:114:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:133:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:148:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:169:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:190:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:211:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:242:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (78ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:

      [31mUncaught AssertionError: expected 500 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-500[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:17:35)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:58:38)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:16:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:33:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:46:57)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:81:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:114:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:133:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:148:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:169:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:190:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:211:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:242:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (77ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:

      [31mUncaught AssertionError: expected 500 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-500[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:17:35)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:58:38)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:16:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:33:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:46:57)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:81:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:114:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:133:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:148:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:169:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:190:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:211:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:242:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnnpm run dev[?1l>[?2004l
]2;npm run dev]1;npm
> express-basics-castle-attack@1.0.0 dev /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> nodemon app.js

[33m[nodemon] 1.17.3[39m
[33m[nodemon] to restart at any time, enter `rs`[39m
[33m[nodemon] watching: *.*[39m
[32m[nodemon] starting `node app.js`[39m
TypeError: Cannot read property 'name' of undefined
    at app.post (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/app.js:22:32)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:137:13)
    at Route.dispatch (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:112:3)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at /home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:281:22
    at Function.process_params (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:335:12)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:275:10)
    at jsonParser (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/body-parser/lib/types/json.js:118:7)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
ReferenceError: data is not defined
    at app.post (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/app.js:31:15)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:137:13)
    at Route.dispatch (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:112:3)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at /home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:281:22
    at Function.process_params (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:335:12)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:275:10)
    at jsonParser (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/body-parser/lib/types/json.js:118:7)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
TypeError: Assignment to constant variable.
    at app.post (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/app.js:32:7)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:137:13)
    at Route.dispatch (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:112:3)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at /home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:281:22
    at Function.process_params (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:335:12)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:275:10)
    at jsonParser (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/body-parser/lib/types/json.js:118:7)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
TypeError: Assignment to constant variable.
    at app.post (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/app.js:28:7)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:137:13)
    at Route.dispatch (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:112:3)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at /home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:281:22
    at Function.process_params (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:335:12)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:275:10)
    at jsonParser (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/body-parser/lib/types/json.js:118:7)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
ReferenceError: kingly is not defined
    at app.post (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/app.js:26:19)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:137:13)
    at Route.dispatch (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:112:3)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at /home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:281:22
    at Function.process_params (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:335:12)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:275:10)
    at jsonParser (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/body-parser/lib/types/json.js:118:7)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
TypeError: Assignment to constant variable.
    at app.post (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/app.js:28:7)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:137:13)
    at Route.dispatch (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:112:3)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at /home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:281:22
    at Function.process_params (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:335:12)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:275:10)
    at jsonParser (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/body-parser/lib/types/json.js:118:7)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
^C
[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm run devtest   [?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (95ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:

      [31mUncaught AssertionError: expected 200 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-200[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:17:35)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 500 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-500[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:60:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:

      [31mUncaught AssertionError: expected 404 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.end (test/02.castles.routes.js:18:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:

      [31mUncaught AssertionError: expected 404 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/02.castles.routes.js:36:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:

      [31mUncaught AssertionError: expected 404 to equal 400[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+400[0m
      [0m[90m
      at chai.request.post.end (test/02.castles.routes.js:52:49)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/02.castles.routes.js:83:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:117:66)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:136:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:151:55)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'health' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:171:47)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'health' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:192:47)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:214:67)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:245:55)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (32s)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:
[0m[31m     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
  
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:
[0m[31m     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
  
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
  
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
  
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
  
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
  
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
  
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
  
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
  
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
  
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
  
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
  
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
  
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
  
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
  
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
  
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnnpm run dev[?1l>[?2004l
]2;npm run dev]1;npm
> express-basics-castle-attack@1.0.0 dev /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> nodemon app.js

[33m[nodemon] 1.17.3[39m
[33m[nodemon] to restart at any time, enter `rs`[39m
[33m[nodemon] watching: *.*[39m
[32m[nodemon] starting `node app.js`[39m
TypeError: Cannot read property 'name' of undefined
    at app.post (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/app.js:21:32)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:137:13)
    at Route.dispatch (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:112:3)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at /home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:281:22
    at Function.process_params (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:335:12)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:275:10)
    at jsonParser (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/body-parser/lib/types/json.js:118:7)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
TypeError: Cannot read property 'name' of undefined
    at app.post (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/app.js:21:32)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:137:13)
    at Route.dispatch (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:112:3)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at /home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:281:22
    at Function.process_params (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:335:12)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:275:10)
    at jsonParser (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/body-parser/lib/types/json.js:118:7)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
TypeError: Cannot read property 'name' of undefined
    at app.post (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/app.js:21:32)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:137:13)
    at Route.dispatch (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:112:3)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at /home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:281:22
    at Function.process_params (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:335:12)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:275:10)
    at jsonParser (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/body-parser/lib/types/json.js:118:7)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
/home/joshua/Documents/Work/Express/node-express-castle-attack-master/app.js:26
    res.send({req.params})
                 ^

SyntaxError: Unexpected token .
    at new Script (vm.js:80:7)
    at createScript (vm.js:264:10)
    at Object.runInThisContext (vm.js:316:10)
    at Module._compile (internal/modules/cjs/loader.js:670:28)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:718:10)
    at Module.load (internal/modules/cjs/loader.js:605:32)
    at tryModuleLoad (internal/modules/cjs/loader.js:544:12)
    at Function.Module._load (internal/modules/cjs/loader.js:536:3)
    at Function.Module.runMain (internal/modules/cjs/loader.js:760:12)
    at startup (internal/bootstrap/node.js:308:19)
[31m[nodemon] app crashed - waiting for file changes before starting...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
TypeError: Cannot read property 'name' of undefined
    at app.get (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/app.js:31:32)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:137:13)
    at Route.dispatch (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:112:3)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at /home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:281:22
    at Function.process_params (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:335:12)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:275:10)
    at jsonParser (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/body-parser/lib/types/json.js:109:7)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
^C
[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm run devtest   run devtest   [?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (82ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:

      [31mUncaught AssertionError: expected 200 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-200[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:17:35)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 500 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-500[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:58:38)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:16:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:33:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:46:57)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:81:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:114:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:133:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:148:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:169:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:190:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:211:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:242:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (82ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:

      [31mUncaught AssertionError: expected 200 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-200[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:17:35)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 500 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-500[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:58:38)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:16:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:33:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:46:57)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:81:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:114:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:133:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:148:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:169:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:190:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:211:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:242:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm testrun devtest   run dev[?1l>[?2004l
]2;npm run dev]1;npm
> express-basics-castle-attack@1.0.0 dev /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> nodemon app.js

[33m[nodemon] 1.17.3[39m
[33m[nodemon] to restart at any time, enter `rs`[39m
[33m[nodemon] watching: *.*[39m
[32m[nodemon] starting `node app.js`[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
{}
{}
{}
{}
{}
{}
{}
{}
{}
{}
{}
{}
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
{}
{}
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
{}
{}
{}
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
[90mundefined[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
^C
[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (80ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:

      [31mUncaught AssertionError: expected 200 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-200[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:17:35)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:58:38)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:16:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:33:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:46:57)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:81:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:114:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:133:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:148:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:169:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:190:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:211:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:242:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (79ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:

      [31mUncaught AssertionError: expected 500 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-500[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:17:35)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:58:38)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:16:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:33:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:46:57)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:81:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:114:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:133:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:148:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:169:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:190:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:211:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:242:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnnpm run dev[?1l>[?2004l
]2;npm run dev]1;npm
> express-basics-castle-attack@1.0.0 dev /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> nodemon app.js

[33m[nodemon] 1.17.3[39m
[33m[nodemon] to restart at any time, enter `rs`[39m
[33m[nodemon] watching: *.*[39m
[32m[nodemon] starting `node app.js`[39m
TypeError: Cannot read property 'name' of undefined
    at app.post (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/app.js:22:32)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:137:13)
    at Route.dispatch (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/route.js:112:3)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
    at /home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:281:22
    at Function.process_params (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:335:12)
    at next (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/index.js:275:10)
    at jsonParser (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/body-parser/lib/types/json.js:118:7)
    at Layer.handle [as handle_request] (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/router/layer.js:95:5)
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
^C
[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm run devtest   [?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (79ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:

      [31mUncaught AssertionError: expected 500 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-500[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:17:35)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:58:38)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:16:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:33:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:46:57)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:81:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:114:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:133:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:148:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:169:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:190:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:211:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:242:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (79ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:

      [31mUncaught AssertionError: expected 200 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-200[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:17:35)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:58:38)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:16:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:33:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:46:57)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:81:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:114:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:133:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:148:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:169:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:190:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:211:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:242:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (82ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:

      [31mUncaught AssertionError: expected 200 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-200[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:17:35)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:58:38)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:16:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:33:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:46:57)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:81:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:114:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:133:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:148:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:169:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:190:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:211:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:242:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (81ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:

      [31mUncaught AssertionError: expected 200 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-200[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:17:35)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:58:38)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:16:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:33:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:46:57)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:81:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:114:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:133:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:148:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:169:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:190:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:211:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:242:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (95ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:

      [31mUncaught AssertionError: expected 200 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-200[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:17:35)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:60:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:

      [31mUncaught AssertionError: expected 404 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.end (test/02.castles.routes.js:18:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:

      [31mUncaught AssertionError: expected 404 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/02.castles.routes.js:36:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:

      [31mUncaught AssertionError: expected 404 to equal 400[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+400[0m
      [0m[90m
      at chai.request.post.end (test/02.castles.routes.js:52:49)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/02.castles.routes.js:83:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:117:66)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:136:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:151:55)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'health' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:171:47)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'health' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:192:47)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:214:67)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:245:55)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
[36;1mexpress[22;39m [33;1mdeprecated[22;39m [0mres.send(body, status): Use res.status(status).send(body) instead[39m [36mapp.js:26:9[39m
      [32m  âœ“[0m[90m should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  1) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  2) should retrieve the specified kingdom[0m
      [31m  3) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  4) should create a new castle[0m
      [31m  5) should create a new castle with a specified name[0m
      [31m  6) should return an error if a castle cannot be created[0m
      [31m  7) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  8) should retrieve all specified castles[0m
      [31m  9) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  10) should retrieve the specified castle[0m
      [31m  11) should return an error if that castle does not exist[0m
      [31m  12) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  13) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  14) should, when given the action 'build', restore the specified castle[0m
      [31m  15) should, when given an unspecified action, return an error[0m
      [31m  16) should return an error if that castle does not exist[0m
      [31m  17) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 1 passing[0m[90m (99ms)[0m
[31m  17 failing[0m

[0m  1) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:60:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:

      [31mUncaught AssertionError: expected 404 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.end (test/02.castles.routes.js:18:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:

      [31mUncaught AssertionError: expected 404 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/02.castles.routes.js:36:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:

      [31mUncaught AssertionError: expected 404 to equal 400[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+400[0m
      [0m[90m
      at chai.request.post.end (test/02.castles.routes.js:52:49)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/02.castles.routes.js:83:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:117:66)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:136:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:151:55)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'health' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:171:47)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'health' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:192:47)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:214:67)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:245:55)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [32m  âœ“[0m[90m should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  1) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  2) should retrieve the specified kingdom[0m
      [31m  3) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  4) should create a new castle[0m
      [31m  5) should create a new castle with a specified name[0m
      [31m  6) should return an error if a castle cannot be created[0m
      [31m  7) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  8) should retrieve all specified castles[0m
      [31m  9) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  10) should retrieve the specified castle[0m
      [31m  11) should return an error if that castle does not exist[0m
      [31m  12) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  13) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  14) should, when given the action 'build', restore the specified castle[0m
      [31m  15) should, when given an unspecified action, return an error[0m
      [31m  16) should return an error if that castle does not exist[0m
      [31m  17) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 1 passing[0m[90m (97ms)[0m
[31m  17 failing[0m

[0m  1) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:60:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:

      [31mUncaught AssertionError: expected 404 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.end (test/02.castles.routes.js:18:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:

      [31mUncaught AssertionError: expected 404 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/02.castles.routes.js:36:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:

      [31mUncaught AssertionError: expected 404 to equal 400[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+400[0m
      [0m[90m
      at chai.request.post.end (test/02.castles.routes.js:52:49)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/02.castles.routes.js:83:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:117:66)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:136:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:151:55)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'health' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:171:47)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'health' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:192:47)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:214:67)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:245:55)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm test[?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [31m  1) should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 0 passing[0m[90m (80ms)[0m
[31m  18 failing[0m

[0m  1) Castle Attack Kingdoms Resource POST /kingdoms should create a new kingdom or change the name if it exists:
[0m[31m     Uncaught AssertionError: expected undefined to be truthy[0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:18:40)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.send.end (test/01.kingdoms.routes.js:58:38)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:16:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:33:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:46:57)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:81:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:114:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:133:41)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:148:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:169:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:190:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:211:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:242:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:619:12)
      at node_modules/superagent/lib/node/index.js:795:18
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/parsers/json.js:16:7)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm testrun dev[?1l>[?2004l
]2;npm run dev]1;npm
> express-basics-castle-attack@1.0.0 dev /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> nodemon app.js

[33m[nodemon] 1.17.3[39m
[33m[nodemon] to restart at any time, enter `rs`[39m
[33m[nodemon] watching: *.*[39m
[32m[nodemon] starting `node app.js`[39m
^[[A^[[A^Z
[1]  + 8010 suspended  npm run dev
[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm run devtest   [?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[31m  1) Uncaught error outside test suite[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [32m  âœ“[0m[90m should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 1 passing[0m[90m (96ms)[0m
[31m  18 failing[0m

[0m  1)  Uncaught error outside test suite:
[0m[31m     Uncaught Error: listen EADDRINUSE: address already in use :::3000[0m[90m
      at Server.setupListenHandle [as _listen2] (net.js:1290:14)
      at listenInCluster (net.js:1338:12)
      at Server.listen (net.js:1425:7)
      at Function.listen (node_modules/express/lib/application.js:618:24)
      at Object.<anonymous> (app.js:43:5)
      at Module._compile (internal/modules/cjs/loader.js:707:30)
      at Object.Module._extensions..js (internal/modules/cjs/loader.js:718:10)
      at Module.load (internal/modules/cjs/loader.js:605:32)
      at tryModuleLoad (internal/modules/cjs/loader.js:544:12)
      at Function.Module._load (internal/modules/cjs/loader.js:536:3)
      at Module.require (internal/modules/cjs/loader.js:643:17)
      at require (internal/modules/cjs/helpers.js:22:18)
      at Object.<anonymous> (test/01.kingdoms.routes.js:1:75)
      at Module._compile (internal/modules/cjs/loader.js:707:30)
      at Object.Module._extensions..js (internal/modules/cjs/loader.js:718:10)
      at Module.load (internal/modules/cjs/loader.js:605:32)
      at tryModuleLoad (internal/modules/cjs/loader.js:544:12)
      at Function.Module._load (internal/modules/cjs/loader.js:536:3)
      at Module.require (internal/modules/cjs/loader.js:643:17)
      at require (internal/modules/cjs/helpers.js:22:18)
      at Array.forEach (<anonymous>)
      at Module._compile (internal/modules/cjs/loader.js:707:30)
      at Object.Module._extensions..js (internal/modules/cjs/loader.js:718:10)
      at Module.load (internal/modules/cjs/loader.js:605:32)
      at tryModuleLoad (internal/modules/cjs/loader.js:544:12)
      at Function.Module._load (internal/modules/cjs/loader.js:536:3)
      at Function.Module.runMain (internal/modules/cjs/loader.js:760:12)
      at startup (internal/bootstrap/node.js:308:19)
      at bootstrapNodeJSCore (internal/bootstrap/node.js:878:3)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:60:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:

      [31mUncaught AssertionError: expected 404 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.end (test/02.castles.routes.js:18:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:

      [31mUncaught AssertionError: expected 404 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/02.castles.routes.js:36:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:

      [31mUncaught AssertionError: expected 404 to equal 400[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+400[0m
      [0m[90m
      at chai.request.post.end (test/02.castles.routes.js:52:49)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/02.castles.routes.js:83:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:117:66)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:136:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:151:55)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'health' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:171:47)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'health' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:192:47)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:214:67)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:245:55)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004h[?2004l
[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004h[?2004l
[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004h[?2004l
[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm testrun dev[?1l>[?2004l
]2;npm run dev]1;npm
> express-basics-castle-attack@1.0.0 dev /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> nodemon app.js

[33m[nodemon] 1.17.3[39m
[33m[nodemon] to restart at any time, enter `rs`[39m
[33m[nodemon] watching: *.*[39m
[32m[nodemon] starting `node app.js`[39m
events.js:167
      throw er; // Unhandled 'error' event
      ^

Error: listen EADDRINUSE: address already in use :::3000
    at Server.setupListenHandle [as _listen2] (net.js:1290:14)
    at listenInCluster (net.js:1338:12)
    at Server.listen (net.js:1425:7)
    at Function.listen (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/application.js:618:24)
    at Object.<anonymous> (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/app.js:43:5)
    at Module._compile (internal/modules/cjs/loader.js:707:30)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:718:10)
    at Module.load (internal/modules/cjs/loader.js:605:32)
    at tryModuleLoad (internal/modules/cjs/loader.js:544:12)
    at Function.Module._load (internal/modules/cjs/loader.js:536:3)
Emitted 'error' event at:
    at emitErrorNT (net.js:1317:8)
    at internalTickCallback (internal/process/next_tick.js:72:19)
    at process._tickCallback (internal/process/next_tick.js:47:5)
    at Function.Module.runMain (internal/modules/cjs/loader.js:763:11)
    at startup (internal/bootstrap/node.js:308:19)
    at bootstrapNodeJSCore (internal/bootstrap/node.js:878:3)
[31m[nodemon] app crashed - waiting for file changes before starting...[39m
^C
[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnpm run devtest   [?1l>[?2004l
]2;npm test]1;npm
> express-basics-castle-attack@1.0.0 test /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> NODE_ENV=test mocha


[0m[0m
[31m  1) Uncaught error outside test suite[0m
[0m  Castle Attack[0m
[0m    Kingdoms Resource[0m
[0m      POST /kingdoms[0m
      [32m  âœ“[0m[90m should create a new kingdom or change the name if it exists[0m
[0m      GET /kingdoms[0m
      [31m  2) retrieve a list of all kingdoms[0m
[0m      GET /kingdoms/:id[0m
      [31m  3) should retrieve the specified kingdom[0m
      [31m  4) should return an error if that kingdom does not exist[0m

[0m  Castle Attack[0m
[0m    Castles Resource[0m
[0m      POST /kingdoms/:id/castles[0m
      [31m  5) should create a new castle[0m
      [31m  6) should create a new castle with a specified name[0m
      [31m  7) should return an error if a castle cannot be created[0m
      [31m  8) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles[0m
      [31m  9) should retrieve all specified castles[0m
      [31m  10) should throw an error if the kingdom id does not match the kingdom[0m
[0m      GET /kingdoms/:id/castles/:castleId[0m
      [31m  11) should retrieve the specified castle[0m
      [31m  12) should return an error if that castle does not exist[0m
      [31m  13) should throw an error if the kingdom id does not match the kingdom[0m
[0m      POST /kingdoms/:id/castles/:castleId[0m
      [31m  14) should, when given the action 'attack', deal damage to the specified castle[0m
      [31m  15) should, when given the action 'build', restore the specified castle[0m
      [31m  16) should, when given an unspecified action, return an error[0m
      [31m  17) should return an error if that castle does not exist[0m
      [31m  18) should throw an error if the kingdom id does not match the kingdom[0m


[92m [0m[32m 1 passing[0m[90m (95ms)[0m
[31m  18 failing[0m

[0m  1)  Uncaught error outside test suite:
[0m[31m     Uncaught Error: listen EADDRINUSE: address already in use :::3000[0m[90m
      at Server.setupListenHandle [as _listen2] (net.js:1290:14)
      at listenInCluster (net.js:1338:12)
      at Server.listen (net.js:1425:7)
      at Function.listen (node_modules/express/lib/application.js:618:24)
      at Object.<anonymous> (app.js:43:5)
      at Module._compile (internal/modules/cjs/loader.js:707:30)
      at Object.Module._extensions..js (internal/modules/cjs/loader.js:718:10)
      at Module.load (internal/modules/cjs/loader.js:605:32)
      at tryModuleLoad (internal/modules/cjs/loader.js:544:12)
      at Function.Module._load (internal/modules/cjs/loader.js:536:3)
      at Module.require (internal/modules/cjs/loader.js:643:17)
      at require (internal/modules/cjs/helpers.js:22:18)
      at Object.<anonymous> (test/01.kingdoms.routes.js:1:75)
      at Module._compile (internal/modules/cjs/loader.js:707:30)
      at Object.Module._extensions..js (internal/modules/cjs/loader.js:718:10)
      at Module.load (internal/modules/cjs/loader.js:605:32)
      at tryModuleLoad (internal/modules/cjs/loader.js:544:12)
      at Function.Module._load (internal/modules/cjs/loader.js:536:3)
      at Module.require (internal/modules/cjs/loader.js:643:17)
      at require (internal/modules/cjs/helpers.js:22:18)
      at Array.forEach (<anonymous>)
      at Module._compile (internal/modules/cjs/loader.js:707:30)
      at Object.Module._extensions..js (internal/modules/cjs/loader.js:718:10)
      at Module.load (internal/modules/cjs/loader.js:605:32)
      at tryModuleLoad (internal/modules/cjs/loader.js:544:12)
      at Function.Module._load (internal/modules/cjs/loader.js:536:3)
      at Function.Module.runMain (internal/modules/cjs/loader.js:760:12)
      at startup (internal/bootstrap/node.js:308:19)
      at bootstrapNodeJSCore (internal/bootstrap/node.js:878:3)
[0m
[0m  2) Castle Attack Kingdoms Resource GET /kingdoms retrieve a list of all kingdoms:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:37:37)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  3) Castle Attack Kingdoms Resource GET /kingdoms/:id should retrieve the specified kingdom:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:60:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  4) Castle Attack Kingdoms Resource GET /kingdoms/:id should return an error if that kingdom does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/01.kingdoms.routes.js:79:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  5) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle:

      [31mUncaught AssertionError: expected 404 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.end (test/02.castles.routes.js:18:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  6) Castle Attack Castles Resource POST /kingdoms/:id/castles should create a new castle with a specified name:

      [31mUncaught AssertionError: expected 404 to equal 201[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+201[0m
      [0m[90m
      at chai.request.post.send.end (test/02.castles.routes.js:36:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  7) Castle Attack Castles Resource POST /kingdoms/:id/castles should return an error if a castle cannot be created:

      [31mUncaught AssertionError: expected 404 to equal 400[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+400[0m
      [0m[90m
      at chai.request.post.end (test/02.castles.routes.js:52:49)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  8) Castle Attack Castles Resource POST /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:68:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  9) Castle Attack Castles Resource GET /kingdoms/:id/castles should retrieve all specified castles:

      [31mUncaught AssertionError: expected 404 to equal 200[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-404[0m
      [32m+200[0m
      [0m[90m
      at chai.request.get.end (test/02.castles.routes.js:83:39)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  10) Castle Attack Castles Resource GET /kingdoms/:id/castles should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:100:44)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  11) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should retrieve the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:117:66)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  12) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:136:46)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  13) Castle Attack Castles Resource GET /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:151:55)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  14) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'attack', deal damage to the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'health' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:171:47)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  15) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given the action 'build', restore the specified castle:
[0m[31m     Uncaught TypeError: Cannot read property 'health' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:192:47)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  16) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should, when given an unspecified action, return an error:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:214:67)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  17) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should return an error if that castle does not exist:
[0m[31m     Uncaught AssertionError: expected undefined to be an object[0m[90m
      at chai.request.get.end (test/02.castles.routes.js:231:42)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m
[0m  18) Castle Attack Castles Resource POST /kingdoms/:id/castles/:castleId should throw an error if the kingdom id does not match the kingdom:
[0m[31m     Uncaught TypeError: Cannot read property 'id' of undefined[0m[90m
      at chai.request.post.end (test/02.castles.routes.js:245:55)
      at Test.Request.callback (node_modules/superagent/lib/node/index.js:631:3)
      at IncomingMessage.<anonymous> (node_modules/superagent/lib/node/index.js:795:18)
      at endReadableNT (_stream_readable.js:1094:12)
      at process.internalTickCallback (internal/process/next_tick.js:72:19)
[0m


[37;40mnpm[0m [0m[31;40mERR![0m[35m[0m Test failed.  See above for more details.
[0m[1m[7m%[27m[1m[0m                                                                                                                                                         ]2;joshua@joshua-ThinkPad-W530: ~/Documents/Work/Express/node-express-castle-attack-master]1;..attack-master[0m[27m[24m[J[01;31mâžœ  [36mnode-express-castle-attack-master[00m [K[?1h=[?2004hnnpm run dev[?1l>[?2004l
]2;npm run dev]1;npm
> express-basics-castle-attack@1.0.0 dev /home/joshua/Documents/Work/Express/node-express-castle-attack-master
> nodemon app.js

[33m[nodemon] 1.17.3[39m
[33m[nodemon] to restart at any time, enter `rs`[39m
[33m[nodemon] watching: *.*[39m
[32m[nodemon] starting `node app.js`[39m
events.js:167
      throw er; // Unhandled 'error' event
      ^

Error: listen EADDRINUSE: address already in use :::3000
    at Server.setupListenHandle [as _listen2] (net.js:1290:14)
    at listenInCluster (net.js:1338:12)
    at Server.listen (net.js:1425:7)
    at Function.listen (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/application.js:618:24)
    at Object.<anonymous> (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/app.js:43:5)
    at Module._compile (internal/modules/cjs/loader.js:707:30)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:718:10)
    at Module.load (internal/modules/cjs/loader.js:605:32)
    at tryModuleLoad (internal/modules/cjs/loader.js:544:12)
    at Function.Module._load (internal/modules/cjs/loader.js:536:3)
Emitted 'error' event at:
    at emitErrorNT (net.js:1317:8)
    at internalTickCallback (internal/process/next_tick.js:72:19)
    at process._tickCallback (internal/process/next_tick.js:47:5)
    at Function.Module.runMain (internal/modules/cjs/loader.js:763:11)
    at startup (internal/bootstrap/node.js:308:19)
    at bootstrapNodeJSCore (internal/bootstrap/node.js:878:3)
[31m[nodemon] app crashed - waiting for file changes before starting...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
events.js:167
      throw er; // Unhandled 'error' event
      ^

Error: listen EADDRINUSE: address already in use :::3000
    at Server.setupListenHandle [as _listen2] (net.js:1290:14)
    at listenInCluster (net.js:1338:12)
    at Server.listen (net.js:1425:7)
    at Function.listen (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/application.js:618:24)
    at Object.<anonymous> (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/app.js:33:5)
    at Module._compile (internal/modules/cjs/loader.js:707:30)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:718:10)
    at Module.load (internal/modules/cjs/loader.js:605:32)
    at tryModuleLoad (internal/modules/cjs/loader.js:544:12)
    at Function.Module._load (internal/modules/cjs/loader.js:536:3)
Emitted 'error' event at:
    at emitErrorNT (net.js:1317:8)
    at internalTickCallback (internal/process/next_tick.js:72:19)
    at process._tickCallback (internal/process/next_tick.js:47:5)
    at Function.Module.runMain (internal/modules/cjs/loader.js:763:11)
    at startup (internal/bootstrap/node.js:308:19)
    at bootstrapNodeJSCore (internal/bootstrap/node.js:878:3)
[31m[nodemon] app crashed - waiting for file changes before starting...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node app.js`[39m
events.js:167
      throw er; // Unhandled 'error' event
      ^

Error: listen EADDRINUSE: address already in use :::3000
    at Server.setupListenHandle [as _listen2] (net.js:1290:14)
    at listenInCluster (net.js:1338:12)
    at Server.listen (net.js:1425:7)
    at Function.listen (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/node_modules/express/lib/application.js:618:24)
    at Object.<anonymous> (/home/joshua/Documents/Work/Express/node-express-castle-attack-master/app.js:28:5)
    at Module._compile (internal/modules/cjs/loader.js:707:30)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:718:10)
    at Module.load (internal/modules/cjs/loader.js:605:32)
    at tryModuleLoad (internal/modules/cjs/loader.js:544:12)
    at Function.Module._load (internal/modules/cjs/loader.js:536:3)
Emitted 'error' event at:
    at emitErrorNT (net.js:1317:8)
    at internalTickCallback (internal/process/next_tick.js:72:19)
    at process._tickCallback (internal/process/next_tick.js:47:5)
    at Function.Module.runMain (internal/modules/cjs/loader.js:763:11)
    at startup (int